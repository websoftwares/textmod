name: Run the flyway container migrations
on:
  push:
    branches:
      - main
    paths:
      - .github/workflows/flyway_run_container_migration.yml
jobs:
  run-command:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Command in Docker Container
        uses: docker/cli@v2
        with:
          command: |
            info
            repair
            migrate
            info
          image: ghcr.io/websoftwares/textmod/flyway/32d6b8f9112f9ba253bd6817471a6e8a732ecf12:latest
          env:
            FLYWAY_MIXED: "\"true\""
            FLYWAY_EDITION: community
            FLYWAY_URL: jdbc:mysql://textmod-mysql-server.mysql.database.azure.com:3306?useUnicode=true&characterEncoding=UTF-8&useSSL=true
            FLYWAY_SCHEMAS: textmod
            FLYWAY_USER: textmod_admin
            FLYWAY_PASSWORD: ${{ secrets.mysql_admin_password }}